<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Clínicas - PetBooking</title>
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/catalogo-clinicas.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="navbar">
            <a href="../index.html" class="logo">
                <img src="../img/logo.png" alt="VetBooking Logo" onerror="this.onerror=null;this.src='../img/Imagem do WhatsApp de 2025-09-17 à(s) 15.28.08_75e67870.jpg'">
                <span class="logo-text">VetBooking</span>
            </a>

            <nav class="nav-links">
                <a href="../index.html" class="nav-link">Página Inicial</a>
                <a href="/pages/catalogo-clinicas.html" class="nav-link active">Clínicas</a>
                <a href="../pages/como-funciona.html" class="nav-link">Como Funciona</a>
            </nav>

            <div class="header-actions">
                <input id="search-input" class="search-input" type="search" placeholder="Buscar clínica, cidade ou serviço">
                <select id="ordenar" class="sort-select" aria-label="Ordenar por">
                    <option value="relevancia">Relevância</option>
                    <option value="avaliacao">Melhor avaliação</option>
                    <option value="preco-menor">Menor preço</option>
                    <option value="preco-maior">Maior preço</option>
                </select>
            </div>
        </div>
    </header>

    <main class="main-container">
        <section class="catalog-section">
            <div class="catalog-header">
                <div>
                    <h1>Clínicas</h1>
                    <p class="catalog-description">Encontre as melhores clínicas para cuidar do seu pet</p>
                </div>
            </div>

            <div class="clinic-cards" id="clinic-cards">
                <!-- cards carregados via JS -->
                <p class="loading">Carregando clínicas…</p>
            </div>

            <div class="pagination" id="pagination">
                <a href="#" class="active">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
                <a href="#" class="next">Próxima <i class="fas fa-chevron-right"></i></a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-brand">
        <span class="footer-logo-text">VetBooking</span>
                <p class="footer-description">Conectando tutores às melhores clínicas para cuidar do seu pet.</p>
            </div>
            <div class="footer-links-col">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="../index.html">Página Inicial</a></li>
                    <li><a href="/pages/catalogo-clinicas.html">Buscar Clínicas</a></li>
                    <li><a href="/pages/login.html">Minha Conta</a></li>
                </ul>
            </div>
            <div class="footer-links-col">
                <h3>Contato</h3>
                <ul>
                    <li><a href="mailto:contato@vetbooking.com">contato@vetbooking.com</a></li>
                    <li><a href="tel:+5541999999999">(41) 99999-9999</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 VetBooking. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
    const DEFAULT_CLINIC_IMAGES = [
      'https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?auto=format&fit=crop&w=1350&q=80',
      'https://images.unsplash.com/photo-1583301286816-f4f05e1e8b25?auto=format&fit=crop&w=1350&q=80',
      'https://images.unsplash.com/photo-1584794171574-fe3f84b43838?auto=format&fit=crop&w=1350&q=80',
      'https://images.unsplash.com/photo-1557800636-894a64c1696f?auto=format&fit=crop&w=1350&q=80',
      'https://images.unsplash.com/photo-1502673530728-f79b4cab31b1?auto=format&fit=crop&w=1350&q=80',
      'https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?auto=format&fit=crop&w=1350&q=80'
    ];

    function getRandomClinicImage() {
        return DEFAULT_CLINIC_IMAGES[Math.floor(Math.random() * DEFAULT_CLINIC_IMAGES.length)];
    }

    function createClinicCard(clinic) {
        const hasImage = clinic.imagem && !/default-clinic/i.test(clinic.imagem);
        const imgSrc = hasImage ? clinic.imagem : getRandomClinicImage();

        const el = document.createElement('div');
        el.className = 'clinic-card';
        el.innerHTML = `
            <div class="clinic-image">
                <img src="${imgSrc}" alt="${clinic.nome || 'Clínica'}" loading="lazy" onerror="this.src='https://via.placeholder.com/600x360?text=Sem+Foto'">
            </div>
            <div class="clinic-info">
                <h3 class="clinic-name">${clinic.nome || '-'}</h3>
                <p class="clinic-services">${clinic.servicos || clinic.caracteristicas || ''}</p>
                <div class="clinic-metadata">
                    <div class="clinic-rating">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        <span class="muted">${clinic.avaliacao || '—'}</span>
                    </div>
                    <div class="clinic-location"><i class="fas fa-map-marker-alt"></i> ${clinic.localizacao || (clinic.cidade ? clinic.cidade + (clinic.uf ? ', ' + clinic.uf : '') : 'Local não informado')}</div>
                </div>
                <div class="clinic-footer">
                    <a href="/pages/clinica-tutor.html?clinica_id=${clinic.id}" class="btn btn-outline">Ver Detalhes</a>
                    <a href="/pages/agendar-consulta.html?clinica_id=${clinic.id}" class="btn btn-primary">Agendar</a>
                </div>
            </div>
        `;
        return el;
    }

    async function loadClinics() {
        const container = document.getElementById('clinic-cards');
        const q = document.getElementById('search-input');
        const sort = document.getElementById('ordenar');

        container.innerHTML = '<p class="loading">Carregando clínicas…</p>';
        try {
            const res = await fetch('/api/clinicas', { credentials: 'same-origin' });
            if (!res.ok) throw new Error('Erro na API');
            let data = await res.json();

            // filtro simples via busca
            const term = (q && q.value || '').toLowerCase().trim();
            if (term) {
                data = data.filter(c => (c.nome || '').toLowerCase().includes(term) || (c.localizacao || '').toLowerCase().includes(term) || (c.caracteristicas || '').toLowerCase().includes(term));
            }

            // ordenação simples
            if (sort && sort.value === 'avaliacao') {
                data.sort((a,b) => (parseFloat(b.avaliacao) || 0) - (parseFloat(a.avaliacao) || 0));
            }

            container.innerHTML = '';
            if (!data || data.length === 0) {
                container.innerHTML = '<p class="loading">Nenhuma clínica encontrada.</p>';
                return;
            }

            // grid render
            data.forEach(clinic => {
                container.appendChild(createClinicCard(clinic));
            });
        } catch (err) {
            console.error(err);
            container.innerHTML = '<p class="loading">Erro ao carregar clínicas.</p>';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadClinics();
        document.getElementById('search-input').addEventListener('input', () => { clearTimeout(window.__catalogo_search_timer); window.__catalogo_search_timer = setTimeout(loadClinics, 300); });
        document.getElementById('ordenar').addEventListener('change', loadClinics);
    });
    </script>
</body>
</html>